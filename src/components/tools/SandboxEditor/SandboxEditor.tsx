import React, { PropsWithChildren, useEffect, useState } from 'react';
import Button from '~/components/ui/Button/Button';
import Separator from '~/components/ui/Separator/Separator';
import Heading from '~/components/ui/Heading/Heading';
import Text from '~/components/ui/Text/Text';

import RovingFocusGroup from '~/core/utils/RovingFocusGroup';

import Theme from '~/components/ui/Theme/Theme';

import colors from '~/design-systems/clarity/tokens/colors';

const SunIcon = () => {
    return <svg width="16" height="16" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 0C7.77614 0 8 0.223858 8 0.5V2.5C8 2.77614 7.77614 3 7.5 3C7.22386 3 7 2.77614 7 2.5V0.5C7 0.223858 7.22386 0 7.5 0ZM2.1967 2.1967C2.39196 2.00144 2.70854 2.00144 2.90381 2.1967L4.31802 3.61091C4.51328 3.80617 4.51328 4.12276 4.31802 4.31802C4.12276 4.51328 3.80617 4.51328 3.61091 4.31802L2.1967 2.90381C2.00144 2.70854 2.00144 2.39196 2.1967 2.1967ZM0.5 7C0.223858 7 0 7.22386 0 7.5C0 7.77614 0.223858 8 0.5 8H2.5C2.77614 8 3 7.77614 3 7.5C3 7.22386 2.77614 7 2.5 7H0.5ZM2.1967 12.8033C2.00144 12.608 2.00144 12.2915 2.1967 12.0962L3.61091 10.682C3.80617 10.4867 4.12276 10.4867 4.31802 10.682C4.51328 10.8772 4.51328 11.1938 4.31802 11.3891L2.90381 12.8033C2.70854 12.9986 2.39196 12.9986 2.1967 12.8033ZM12.5 7C12.2239 7 12 7.22386 12 7.5C12 7.77614 12.2239 8 12.5 8H14.5C14.7761 8 15 7.77614 15 7.5C15 7.22386 14.7761 7 14.5 7H12.5ZM10.682 4.31802C10.4867 4.12276 10.4867 3.80617 10.682 3.61091L12.0962 2.1967C12.2915 2.00144 12.608 2.00144 12.8033 2.1967C12.9986 2.39196 12.9986 2.70854 12.8033 2.90381L11.3891 4.31802C11.1938 4.51328 10.8772 4.51328 10.682 4.31802ZM8 12.5C8 12.2239 7.77614 12 7.5 12C7.22386 12 7 12.2239 7 12.5V14.5C7 14.7761 7.22386 15 7.5 15C7.77614 15 8 14.7761 8 14.5V12.5ZM10.682 10.682C10.8772 10.4867 11.1938 10.4867 11.3891 10.682L12.8033 12.0962C12.9986 12.2915 12.9986 12.608 12.8033 12.8033C12.608 12.9986 12.2915 12.9986 12.0962 12.8033L10.682 11.3891C10.4867 11.1938 10.4867 10.8772 10.682 10.682ZM5.5 7.5C5.5 6.39543 6.39543 5.5 7.5 5.5C8.60457 5.5 9.5 6.39543 9.5 7.5C9.5 8.60457 8.60457 9.5 7.5 9.5C6.39543 9.5 5.5 8.60457 5.5 7.5ZM7.5 4.5C5.84315 4.5 4.5 5.84315 4.5 7.5C4.5 9.15685 5.84315 10.5 7.5 10.5C9.15685 10.5 10.5 9.15685 10.5 7.5C10.5 5.84315 9.15685 4.5 7.5 4.5Z" fill="currentColor" fillRule="evenodd" clipRule="evenodd"></path></svg>;
};

const MoonIcon = () => {
    return <svg width="16" height="16" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" ><path d="M2.89998 0.499976C2.89998 0.279062 2.72089 0.0999756 2.49998 0.0999756C2.27906 0.0999756 2.09998 0.279062 2.09998 0.499976V1.09998H1.49998C1.27906 1.09998 1.09998 1.27906 1.09998 1.49998C1.09998 1.72089 1.27906 1.89998 1.49998 1.89998H2.09998V2.49998C2.09998 2.72089 2.27906 2.89998 2.49998 2.89998C2.72089 2.89998 2.89998 2.72089 2.89998 2.49998V1.89998H3.49998C3.72089 1.89998 3.89998 1.72089 3.89998 1.49998C3.89998 1.27906 3.72089 1.09998 3.49998 1.09998H2.89998V0.499976ZM5.89998 3.49998C5.89998 3.27906 5.72089 3.09998 5.49998 3.09998C5.27906 3.09998 5.09998 3.27906 5.09998 3.49998V4.09998H4.49998C4.27906 4.09998 4.09998 4.27906 4.09998 4.49998C4.09998 4.72089 4.27906 4.89998 4.49998 4.89998H5.09998V5.49998C5.09998 5.72089 5.27906 5.89998 5.49998 5.89998C5.72089 5.89998 5.89998 5.72089 5.89998 5.49998V4.89998H6.49998C6.72089 4.89998 6.89998 4.72089 6.89998 4.49998C6.89998 4.27906 6.72089 4.09998 6.49998 4.09998H5.89998V3.49998ZM1.89998 6.49998C1.89998 6.27906 1.72089 6.09998 1.49998 6.09998C1.27906 6.09998 1.09998 6.27906 1.09998 6.49998V7.09998H0.499976C0.279062 7.09998 0.0999756 7.27906 0.0999756 7.49998C0.0999756 7.72089 0.279062 7.89998 0.499976 7.89998H1.09998V8.49998C1.09998 8.72089 1.27906 8.89997 1.49998 8.89997C1.72089 8.89997 1.89998 8.72089 1.89998 8.49998V7.89998H2.49998C2.72089 7.89998 2.89998 7.72089 2.89998 7.49998C2.89998 7.27906 2.72089 7.09998 2.49998 7.09998H1.89998V6.49998ZM8.54406 0.98184L8.24618 0.941586C8.03275 0.917676 7.90692 1.1655 8.02936 1.34194C8.17013 1.54479 8.29981 1.75592 8.41754 1.97445C8.91878 2.90485 9.20322 3.96932 9.20322 5.10022C9.20322 8.37201 6.82247 11.0878 3.69887 11.6097C3.45736 11.65 3.20988 11.6772 2.96008 11.6906C2.74563 11.702 2.62729 11.9535 2.77721 12.1072C2.84551 12.1773 2.91535 12.2458 2.98667 12.3128L3.05883 12.3795L3.31883 12.6045L3.50684 12.7532L3.62796 12.8433L3.81491 12.9742L3.99079 13.089C4.11175 13.1651 4.23536 13.2375 4.36157 13.3059L4.62496 13.4412L4.88553 13.5607L5.18837 13.6828L5.43169 13.7686C5.56564 13.8128 5.70149 13.8529 5.83857 13.8885C5.94262 13.9155 6.04767 13.9401 6.15405 13.9622C6.27993 13.9883 6.40713 14.0109 6.53544 14.0298L6.85241 14.0685L7.11934 14.0892C7.24637 14.0965 7.37436 14.1002 7.50322 14.1002C11.1483 14.1002 14.1032 11.1453 14.1032 7.50023C14.1032 7.25044 14.0893 7.00389 14.0623 6.76131L14.0255 6.48407C13.991 6.26083 13.9453 6.04129 13.8891 5.82642C13.8213 5.56709 13.7382 5.31398 13.6409 5.06881L13.5279 4.80132L13.4507 4.63542L13.3766 4.48666C13.2178 4.17773 13.0353 3.88295 12.8312 3.60423L12.6782 3.40352L12.4793 3.16432L12.3157 2.98361L12.1961 2.85951L12.0355 2.70246L11.8134 2.50184L11.4925 2.24191L11.2483 2.06498L10.9562 1.87446L10.6346 1.68894L10.3073 1.52378L10.1938 1.47176L9.95488 1.3706L9.67791 1.2669L9.42566 1.1846L9.10075 1.09489L8.83599 1.03486L8.54406 0.98184ZM10.4032 5.30023C10.4032 4.27588 10.2002 3.29829 9.83244 2.40604C11.7623 3.28995 13.1032 5.23862 13.1032 7.50023C13.1032 10.593 10.596 13.1002 7.50322 13.1002C6.63646 13.1002 5.81597 12.9036 5.08355 12.5522C6.5419 12.0941 7.81081 11.2082 8.74322 10.0416C8.87963 10.2284 9.10028 10.3497 9.34928 10.3497C9.76349 10.3497 10.0993 10.0139 10.0993 9.59971C10.0993 9.24256 9.84965 8.94373 9.51535 8.86816C9.57741 8.75165 9.63653 8.63334 9.6926 8.51332C9.88358 8.63163 10.1088 8.69993 10.35 8.69993C11.0403 8.69993 11.6 8.14028 11.6 7.44993C11.6 6.75976 11.0406 6.20024 10.3505 6.19993C10.3853 5.90487 10.4032 5.60464 10.4032 5.30023Z" fill="currentColor" fillRule="evenodd" clipRule="evenodd"></path></svg>;
};

const RadUILogo = () => {
    return <svg xmlns="http://www.w3.org/2000/svg" width="50" height="15" viewBox="0 0 951 275" fill="none"><path d="M211.75 272.493C194.441 267.63 180.91 259.376 166.776 245.07C145.884 223.912 136.769 201.743 136.804 172.243C136.857 141.767 146.647 117.84 167.751 96.5938C187.507 76.6964 209.675 67.5021 237.998 67.4666C262.471 67.4311 279.638 73.892 295.83 89.2099L305.265 98.138V87.2397C305.265 74.176 306.63 73.6967 318.317 82.6248C327.238 89.4407 337.914 102.877 344.192 115.195C353.556 133.549 353.733 135.111 354.46 204.441L355.152 269.529L350.168 270.115C347.42 270.417 335.396 270.434 323.443 270.133L301.718 269.6V259.926C301.718 254.619 301.292 250.271 300.778 250.271C300.263 250.271 295.67 253.59 290.58 257.637C274.123 270.736 264.741 273.966 241.42 274.57C227.445 274.925 218.117 274.268 211.75 272.493ZM270.044 224.818C281.518 219.191 290.669 209.801 296.77 197.43C301.806 187.188 302.604 183.727 302.604 172.207C302.604 161.185 301.735 157.102 297.657 148.76C284.693 122.366 255.963 109.658 228.971 118.373C216.752 122.331 202.316 135.519 195.931 148.6C182.701 175.651 195.789 210.156 224.537 224.001C234.078 228.598 236.721 229.095 249.401 228.563C258.357 228.19 265.965 226.806 270.044 224.818ZM456.203 272.316C429.938 265.251 404.791 243.845 392.43 218.055C383.474 199.382 380.778 185.609 381.966 164.593C383.58 136.069 394.505 112.622 414.988 93.6651C435.028 75.1167 460.353 66.2241 488.338 67.8571C509.23 69.0995 521.661 74.3002 534.608 87.2575C540.3 92.9551 545.302 97.6233 545.709 97.6233C546.117 97.6233 546.454 75.6492 546.454 48.8116V0H573.943H601.431V134.898V269.795H573.943H546.454V260.033C546.454 254.673 545.709 250.271 544.787 250.271C543.865 250.271 540.07 253.111 536.363 256.59C522.655 269.405 505.559 275.173 481.847 274.996C472.998 274.943 461.47 273.736 456.203 272.316ZM516.022 223.504C527.603 217.718 535.973 208.967 543.049 195.247C546.383 188.786 547.199 184.384 547.252 172.172C547.341 158.292 546.862 156.197 541.294 145.902C534.945 134.205 527.851 127.496 514.532 120.591C503.129 114.663 481.954 114.627 468.901 120.485C458.065 125.348 446.644 137.045 441.235 148.778C435.631 160.936 435.755 185.928 441.466 196.667C456.877 225.634 488.782 237.136 516.022 223.504ZM750.206 269.156C742.776 266.955 732.632 262.536 727.648 259.341C706.633 245.851 688.81 219.351 684.908 195.815C683.613 187.951 683.081 161.646 683.4 120.698L683.897 57.6865L702.908 57.1895L721.902 56.6748L722.416 124.638L722.913 192.584L727.488 202.364C736.019 220.54 752.618 231.935 773.315 233.817C795.217 235.805 818.041 222.634 827.228 202.737C830.934 194.714 831.129 191.501 831.98 126.023L832.867 57.6865L851.932 57.1895L870.996 56.6748L870.943 126.413C870.908 193.862 870.784 196.507 866.935 207.778C858.192 233.479 842.089 252.223 819.034 263.53C797.114 274.286 773.918 276.185 750.206 269.156ZM19.171 270.31L0 269.671L0.638443 205.399C1.24142 144.518 1.47197 140.471 5.23169 129.2C10.8358 112.391 24.2963 93.0084 36.8878 83.6543L47.2271 75.9687L47.7059 81.9148C47.9719 85.1808 48.6104 89.7602 49.1247 92.0854C50.0469 96.1856 50.3129 96.0791 58.0274 88.3402C62.4078 83.9738 70.3529 78.1696 75.691 75.4717C86.5977 69.9515 109.138 66.1886 119.566 68.1588L126.146 69.3835V93.0084V116.633L109.741 117.698C87.0056 119.189 80.8872 121.514 69.2888 133.069C62.0354 140.294 58.8964 144.997 57.389 150.872C56.1653 155.683 55.1012 180.621 54.6933 213.458C54.3032 243.473 53.647 268.393 53.2036 268.837C51.6784 270.363 38.2002 270.949 19.171 270.31ZM929.946 270.168L911.75 269.671L912.211 163.67L912.673 57.6865L931.737 57.1895L950.802 56.6748V163.137C950.802 221.676 950.199 269.831 949.472 270.133C948.745 270.434 939.948 270.452 929.946 270.168Z" fill="currentColor"/></svg>;
};

type ColorSelectProps = {color:typeof colors[keyof typeof colors], colorName: string, changeAccentColor: (colorName: keyof typeof colors)=>void}

const ColorSelect = ({ color, colorName, changeAccentColor }: ColorSelectProps) => {
    const dimensions = 32;
    return <span
        aria-label={`Change accent color to ${colorName}`}
        className='cursor-pointer rounded-full inline-flex'
        style={{ width: dimensions, height: dimensions, backgroundColor: color.light['900'] }}
    ></span>;
};

type SandboxProps = {className?: string | ''} & PropsWithChildren

const SandboxEditor = ({ children, className } : SandboxProps) => {
    const [isDarkMode, setIsDarkMode] = useState(false);

    type AvailableColors = keyof typeof colors

    const [colorName, setColorName] = useState<AvailableColors>('plum');

    useEffect(() => {
        const isDarkMode = localStorage.getItem('isDarkMode') === 'true';
        setIsDarkMode(isDarkMode);
    }, []);

    const toggleDarkMode = () => {
        localStorage.setItem('isDarkMode', (!isDarkMode).toString());
        setIsDarkMode(!isDarkMode);
    };

    return <Theme
        appearance={isDarkMode ? 'dark' : 'light'}
        accentColor={colorName}>
        <div className={'p-4 shadow-sm text-gray-900 min-h-screen border border-gray-300 bg-gray-50'}>
            <div className='mb-4'>
                {/* @ts-ignore */}
                <div className='flex items-center space-x-4'>
                    <div className='text-gray-1000'>
                        <RadUILogo/>
                    </div>
                    <Separator orientation='vertical' />
                    <Button variant="solid" onClick={toggleDarkMode}>{isDarkMode ? <SunIcon/> : <MoonIcon/>}</Button>
                </div>
                <Separator />
                <div>
                    <div className="flex items-center space-x-4">
                        <Heading as='h1' className="text-gray-1000">Sandbox Editor</Heading>
                        <Separator orientation='vertical' />
                        <Text className="font-normal text-gray-950">
                        Customize the colors of the Rad UI components by clicking on the color swatches below.
                        </Text>
                    </div>
                    <Separator />
                    <RovingFocusGroup.Root >
                        <RovingFocusGroup.Group className='flex space-x-1 my-1'>
                            {Object.keys(colors).map((color, idx) => {
                                const colorName = color as AvailableColors;
                                return <RovingFocusGroup.Item
                                    key={idx}
                                    className='cursor-pointer rounded-full inline-block w-8 h-8 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500'
                                    onFocus={() => setColorName(colorName)}
                                    onClick={() => setColorName(colorName)}
                                >
                                    <button>
                                        <ColorSelect colorName={color} color={colors[colorName]} changeAccentColor={setColorName}/>
                                    </button>
                                </RovingFocusGroup.Item>;
                            }
                            )}
                        </RovingFocusGroup.Group>

                    </RovingFocusGroup.Root>
                </div>
            </div>
            <Separator/>
            <div className={`${className}`} >
                {children}
            </div>
        </div>
    </Theme>;
};

export default SandboxEditor;
